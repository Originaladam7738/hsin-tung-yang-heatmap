# 熱力圖分析系統

這是一個基於平面圖的熱力圖分析系統，可以視覺化呈現人流進出資料。

## 功能特色

1. **平面圖上傳**：支援上傳任意平面圖作為底圖
2. **區域定義**：可在平面圖上框選並命名區域
3. **資料庫連接**：連接 MySQL 資料庫讀取進出紀錄
4. **時間篩選**：可選擇特定時間區間的資料
5. **熱力圖生成**：根據人流資料自動生成熱力圖

## 系統需求

- Node.js (v14 以上)
- MySQL 資料庫
- 現代瀏覽器 (Chrome, Firefox, Safari, Edge)

## 資料庫結構

系統需要一個包含以下欄位的資料表：

```sql
CREATE TABLE entry_exit_records (
    id INT AUTO_INCREMENT PRIMARY KEY,
    時間 DATETIME NOT NULL,
    地區 VARCHAR(100) NOT NULL,
    狀態 ENUM('進', '出') NOT NULL,
    INDEX idx_time (時間),
    INDEX idx_region (地區)
);
```

### 範例資料

```sql
INSERT INTO entry_exit_records (時間, 地區, 狀態) VALUES
('2024-01-15 09:00:00', 'A區', '進'),
('2024-01-15 09:05:00', 'A區', '出'),
('2024-01-15 09:10:00', 'B區', '進'),
('2024-01-15 09:15:00', 'B區', '出'),
('2024-01-15 09:20:00', 'C區', '進');
```

## 安裝步驟

1. 安裝依賴套件：
```bash
npm install
```

2. 啟動伺服器：
```bash
npm start
```

3. 開啟瀏覽器訪問：
```
http://localhost:3000
或使用伺服器 IP: http://your-server-ip:3000

應用程式會自動使用當前瀏覽器的網址,無需額外配置
```

## 使用方法

### 1. 上傳平面圖
- 點擊「選擇檔案」選擇平面圖圖片（支援 PNG、JPG、GIF 等格式）
- 點擊「載入平面圖」按鈕

### 2. 設定資料庫連線
填寫以下資訊：
- **資料庫主機**：預設 `localhost`
- **資料庫名稱**：你的資料庫名稱
- **使用者名稱**：資料庫使用者
- **密碼**：資料庫密碼
- **資料表名稱**：存放進出紀錄的資料表名稱

點擊「連接資料庫」進行連接。

### 3. 定義區域
- 點擊「新增區域」按鈕
- 在平面圖上拖曳滑鼠框選區域
- 輸入區域名稱（必須與資料庫中的「地區」欄位值對應）
- 可以新增多個區域
- 可以修改區域名稱或刪除區域

### 4. 選擇時間區間
- 選擇開始時間
- 選擇結束時間

### 5. 生成熱力圖
- 調整熱力圖強度（1-100）
- 點擊「生成熱力圖」按鈕
- 系統會根據該時間區間內各區域的人流量生成熱力圖

## 技術架構

### 前端
- HTML5 Canvas：繪製平面圖和區域
- heatmap.js：生成熱力圖效果
- 原生 JavaScript：處理互動邏輯

### 後端
- Node.js + Express：API 伺服器
- MySQL2：資料庫連接
- CORS：跨域請求支援

## API 端點

### POST /api/connect
連接資料庫

**請求參數：**
```json
{
  "host": "localhost",
  "database": "heatmap_db",
  "user": "root",
  "password": "password",
  "table": "entry_exit_records"
}
```

### POST /api/heatmap
取得熱力圖資料

**請求參數：**
```json
{
  "regions": ["A區", "B區", "C區"],
  "startTime": "2024-01-15T09:00",
  "endTime": "2024-01-15T18:00"
}
```

### POST /api/statistics
取得統計資料

**請求參數：**
```json
{
  "regions": ["A區", "B區"],
  "startTime": "2024-01-15T09:00",
  "endTime": "2024-01-15T18:00"
}
```

## 注意事項

1. 請確保資料庫欄位名稱為「時間」、「地區」、「狀態」（繁體中文）
2. 狀態欄位的值應為「進」或「出」
3. 區域名稱必須與資料庫中的「地區」值完全一致
4. 建議平面圖尺寸不要過大（建議 2000x2000 像素以內）
5. 時間格式為 `YYYY-MM-DDTHH:mm`

## 故障排除

### 資料庫連接失敗
- 檢查 MySQL 服務是否啟動
- 確認資料庫連線資訊是否正確
- 檢查防火牆設定

### 熱力圖無法顯示
- 確認已定義區域
- 確認區域名稱與資料庫中的「地區」值一致
- 檢查選擇的時間區間內是否有資料

### 區域無法框選
- 確認已載入平面圖
- 嘗試重新整理頁面

## 授權

MIT License
